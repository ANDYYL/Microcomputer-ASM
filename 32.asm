DATA   SEGMENT								;数据段
SONG  DB 7DH,7DH,53H,53H,4BH,4BH,53H
		DB 5EH,5EH,64H,64H,6FH,6FH,7DH
		DB 53H,53H,5EH,5EH,64H,64H,6FH
		DB 53H,53H,5EH,5EH,64H,64H,6FH
		DB 7DH,7DH,53H,53H,4BH,4BH,53H
		DB 5EH,5EH,64H,64H,6FH,6FH,7DH		;音乐音符
CONT  EQU $-SONG
NUM  DB 21H,21H,0D9H,0D9H,0DDH,0DDH,0D9H
		DB 39H,39H,0F1H,0F1H,0F4H,0F4H,21H
		DB 0D9H,0D9H,39H,39H,0F1H,0F1H,0F4H
		DB 0D9H,0D9H,39H,39H,0F1H,0F1H,0F4H
		DB 21H,21H,0D9H,0D9H,0DDH,0DDH,0D9H
		DB 39H,39H,0F1H,0F1H,0F4H,0F4H,21H	;数码管字符
DATA   ENDS

STACK  SEGMENT
		DB 100 DUP(?)
STACK  ENDS

CODE  SEGMENT
		ASSUME CS:CODE,DS:DATA,SS:STACK
START:  MOV AX,DATA
		MOV DS,AX
		MOV SI,OFFSET SONG					;SI存储音乐音符
		MOV DI,OFFSET NUM					;DI存储数码管字符
		MOV CX,CONT
LOOP1: CMP BX,0
		JNZ CONTN
		MOV BX,07H
CONTN: MOV DX,0EE23H							;8253控制字
		MOV AL,16H			;0号计数器，只读写低8位，工作方式3，2进制
		OUT DX,AL
		MOV DX,0EE20H
		MOV AL,[SI]
		OUT DX,AL								;蜂鸣器响
		MOV DX,0EE03H							;8255控制字
		MOV AL,10001001B						;方式3工作
		OUT DX,AL
		MOV DX,0EE01H							;数码管位选
		MOV AL,01H
		OUT DX,AL
		MOV DX,0EE00H							;数码管显示
		MOV AL,[DI]
		OUT DX,AL								;数码管显示音符
		CALL DELAY
		DEC BX
		JNZ NEXT
		CALL DELAY								;延时控制节奏
NEXT:  INC DI
		INC SI
		MOV AH,0BH							;检测键盘输入
		INT 21H
		OR AL,AL
		JNZ ENDLAST
		LOOP LOOP1								;播完设定的歌曲
		JMP START								;重复播放
ENDLAST:MOV DX,0EE00H						;关闭数码管显示
		MOV AL,0
		OUT DX,AL
		MOV DX,0EE20H							;关闭蜂鸣器
		MOV AL,0
		OUT DX,AL  
		MOV AX,4C00H							;退出主程序
		INT 21H

DELAY  PROC NEAR								;延时子程序
		PUSH CX
		PUSH BX
		MOV CX,100FH
		MOV BX,0FFFFH
LOOP2: NOP										;外层循环，循环次数100FH
LOOP3: DEC BX									;内层循环，循环次数为0FFFFH
		JNZ LOOP3
		LOOP LOOP2
		POP BX
		POP CX
		RET
DELAY  ENDP									;一共延100FH*0FFFFH次

CODE  ENDS
		END START 
